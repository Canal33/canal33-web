<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Programación | Canal 33</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: { extend: { colors: { 
                turquesa: '#00ced1', 
                negroPro: '#050505', 
                grisOscuro: '#0f0f0f' 
            } } }
        }
    </script>
    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #00ced1; border-radius: 10px; }
    </style>
</head>
<body class="bg-negroPro text-white">

    <header class="border-b border-gray-800 bg-negroPro/90 backdrop-blur-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <a href="index.html" class="flex items-center gap-3 group">
                <img src="img_logos/CANAL 33.png" alt="Canal 33" class="h-20 w-auto">
            </a>
            <nav class="hidden space-x-8 text-sm font-bold tracking-widest uppercase lg:flex">
                <a href="noticias.html" class="hover:text-turquesa transition">Noticias</a>
                <a href="espectaculos.html" class="hover:text-turquesa transition">Espectáculos</a>
                <a href="deportes.html" class="hover:text-turquesa transition">Deportes</a>
                <a href="programacion.html" class="text-turquesa border-turquesa border-b-2 pb-1">Programación</a>          
                <a href="prensa.html" class="hover:text-turquesa transition">Nosotros</a>
            </nav>
            
            <a href="vivo.html" class="bg-turquesa text-negroPro flex animate-pulse items-center gap-2 rounded-full px-5 py-2 text-xs font-black hover:bg-white transition-colors">
                <span class="h-2 w-2 rounded-full bg-red-600"></span> EN VIVO
            </a>
        </div>
    </header>

    <main class="container mx-auto px-4 py-12">
        <div class="text-center mb-16">
            <h1 class="text-5xl md:text-7xl font-black uppercase tracking-tighter mb-4 italic">Guía de <span class="text-turquesa">Programación</span></h1>
            <p class="text-gray-500 font-bold uppercase tracking-widest text-xs italic">Ordenada por horario oficial</p>
        </div>

        <div class="flex justify-center gap-4 mb-12 overflow-x-auto pb-4">
            <button onclick="cargarProgramacion(55569380, this)" class="dia-btn bg-turquesa text-black px-6 py-2 rounded-full font-black text-xs uppercase transition">Lunes a Viernes</button>
            <button onclick="cargarProgramacion(196448, this)" class="dia-btn border border-gray-800 text-gray-500 px-6 py-2 rounded-full font-black text-xs uppercase transition">Sábados</button>
            <button onclick="cargarProgramacion(205851, this)" class="dia-btn border border-gray-800 text-gray-500 px-6 py-2 rounded-full font-black text-xs uppercase transition">Domingos</button>
        </div>

        <div id="guia-programas" class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
            </div>

        <div id="contenedor-ver-todo" class="flex justify-center mb-20 hidden">
            <button onclick="toggleVerTodo()" id="btn-ver-todo" class="group bg-white/5 border border-gray-800 text-white px-10 py-4 rounded-2xl font-black uppercase text-xs tracking-widest hover:bg-turquesa hover:text-black transition-all">
                Ver programación completa <i class="fas fa-chevron-down ml-2 group-hover:translate-y-1 transition-transform"></i>
            </button>
        </div>

        <div id="modal-detalle" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4 bg-black/95 backdrop-blur-md">
            <div class="bg-grisOscuro border border-gray-800 w-full max-w-3xl rounded-[2.5rem] overflow-hidden relative shadow-2xl">
                <button onclick="cerrarModal()" class="absolute top-6 right-6 text-white/50 hover:text-turquesa text-2xl z-20 bg-black/40 w-10 h-10 rounded-full flex items-center justify-center transition-all">
                    <i class="fas fa-times"></i>
                </button>
                <div id="modal-contenido"></div>
            </div>
        </div>
    </main>

    <script>
        const API_BASE = 'https://public-api.wordpress.com/wp/v2/sites/canal338.wordpress.com/posts';
        let programasCache = [];
        let mostrandoTodo = false;

        async function cargarProgramacion(idCat = 55569380, boton = null) {
            const contenedor = document.getElementById('guia-programas');
            const btnContainer = document.getElementById('contenedor-ver-todo');
            mostrandoTodo = false; // Reset al cambiar de pestaña

            if (boton) {
                document.querySelectorAll('.dia-btn').forEach(btn => {
                    btn.classList.remove('bg-turquesa', 'text-black');
                    btn.classList.add('border', 'border-gray-800', 'text-gray-500');
                });
                boton.classList.replace('text-gray-500', 'text-black');
                boton.classList.add('bg-turquesa');
            }

            contenedor.innerHTML = '<div class="col-span-full py-20 text-center text-turquesa font-black animate-pulse uppercase tracking-widest italic">Organizando Parrilla...</div>';

            try {
                const url = `${API_BASE}?categories=${idCat}&_embed=true&per_page=100`;
                const res = await fetch(url);
                let programas = await res.json();

                // LÓGICA DE ORDENAMIENTO CRONOLÓGICO
                programas.sort((a, b) => {
                    const getMinutos = (p) => {
                        const hStr = p.excerpt.rendered.replace(/<[^>]*>?/gm, '').split('-')[0].trim();
                        const [h, m] = hStr.split(':').map(Number);
                        return (h * 60) + (m || 0);
                    };
                    return getMinutos(a) - getMinutos(b);
                });

                programasCache = programas;
                renderizarProgramas();
                
                if (programas.length > 6) {
                    btnContainer.classList.remove('hidden');
                } else {
                    btnContainer.classList.add('hidden');
                }

            } catch (error) {
                contenedor.innerHTML = `<div class="col-span-full text-center text-red-500 font-bold uppercase">Error de conexión</div>`;
            }
        }

        function renderizarProgramas() {
            const contenedor = document.getElementById('guia-programas');
            const ahora = new Date();
            const minActuales = ahora.getHours() * 60 + ahora.getMinutes();
            
            const listaAMostrar = mostrandoTodo ? programasCache : programasCache.slice(0, 6);
            let html = '';

            listaAMostrar.forEach(prog => {
                const horario = prog.excerpt.rendered.replace(/<[^>]*>?/gm, '').trim() || "00:00 - 00:00";
                const imagen = prog._embedded?.['wp:featuredmedia']?.[0]?.source_url || 'https://via.placeholder.com/1200x600';
                const titulo = prog.title.rendered;
                const desc = prog.content.rendered;
                
                let esAhora = false;
                try {
                    const [hI, mI] = horario.split('-')[0].trim().split(':').map(Number);
                    const [hF, mF] = horario.split('-')[1].trim().split(':').map(Number);
                    if (minActuales >= (hI*60+mI) && minActuales < (hF*60+mF)) esAhora = true;
                } catch(e) {}

                html += `
                    <div onclick="abrirModal('${titulo}', '${horario}', '${imagen}', \`${desc.replace(/"/g, '&quot;')}\`)" 
                        class="group relative h-64 md:h-72 rounded-[2.5rem] overflow-hidden cursor-pointer border ${esAhora ? 'border-turquesa ring-4 ring-turquesa/10' : 'border-gray-800'} transition-all duration-500 hover:scale-[1.02] shadow-2xl shadow-black/50">
                        
                        <img src="${imagen}" class="absolute inset-0 w-full h-full object-cover transition duration-1000 group-hover:scale-110">
                        <div class="absolute inset-0 bg-gradient-to-t from-black via-black/30 to-transparent opacity-90 transition-all duration-500 group-hover:via-black/10"></div>

                        <div class="absolute inset-0 p-8 flex flex-col justify-end">
                            <div class="flex items-center gap-3 mb-2">
                                ${esAhora ? `<span class="bg-red-600 text-white text-[10px] font-black px-3 py-1 rounded-full animate-pulse uppercase tracking-widest">Al Aire</span>` : ''}
                                <span class="text-turquesa font-black italic text-xl drop-shadow-md">${horario}</span>
                            </div>
                            <h3 class="text-3xl md:text-4xl font-black uppercase tracking-tighter text-white leading-none drop-shadow-2xl group-hover:text-turquesa transition-colors">
                                ${titulo}
                            </h3>
                            <p class="text-[10px] text-white/40 font-bold uppercase tracking-[0.2em] mt-4 opacity-0 group-hover:opacity-100 transition-all duration-500">
                                Click para información <i class="fas fa-plus ml-1 text-turquesa"></i>
                            </p>
                        </div>
                    </div>`;
            });

            contenedor.innerHTML = html;
            
            const btn = document.getElementById('btn-ver-todo');
            btn.innerHTML = mostrandoTodo ? 
                `Mostrar menos <i class="fas fa-chevron-up ml-2"></i>` : 
                `Ver programación completa <i class="fas fa-chevron-down ml-2"></i>`;
        }

        function toggleVerTodo() {
            mostrandoTodo = !mostrandoTodo;
            renderizarProgramas();
            if(!mostrandoTodo) {
                window.scrollTo({ top: document.getElementById('guia-programas').offsetTop - 150, behavior: 'smooth' });
            }
        }

        function abrirModal(titulo, hora, img, desc) {
            const modal = document.getElementById('modal-detalle');
            document.getElementById('modal-contenido').innerHTML = `
                <div class="w-full h-64 md:h-80 overflow-hidden relative">
                    <img src="${img}" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-gradient-to-t from-grisOscuro to-transparent"></div>
                    <div class="absolute bottom-6 left-8">
                        <span class="text-turquesa font-black italic text-2xl">${hora}</span>
                        <h2 class="text-4xl md:text-5xl font-black uppercase tracking-tighter text-white drop-shadow-lg leading-none">${titulo}</h2>
                    </div>
                </div>
                <div class="p-8 md:p-10">
                    <div class="text-gray-400 font-medium leading-relaxed max-h-48 overflow-y-auto custom-scrollbar pr-4 mb-8 text-sm md:text-base">
                        ${desc || "Sin descripción disponible."}
                    </div>
                    <div class="flex gap-4">
                        <a href="index.html" class="bg-turquesa text-black px-8 py-4 rounded-2xl font-black uppercase text-xs hover:bg-white transition-all">Ver señal en vivo</a>
                        <button onclick="cerrarModal()" class="bg-white/5 border border-white/10 text-white px-8 py-4 rounded-2xl font-black uppercase text-xs hover:bg-white/10 transition">Cerrar</button>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function cerrarModal() {
            document.getElementById('modal-detalle').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // Carga inicial
        document.addEventListener('DOMContentLoaded', () => cargarProgramacion());
    </script>
</body>
</html>